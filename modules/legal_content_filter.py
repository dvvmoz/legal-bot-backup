"""
–ú–æ–¥—É–ª—å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º –¥–ª—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.
"""
import re
import logging
from typing import Dict, List, Tuple, Optional
from datetime import datetime

logger = logging.getLogger(__name__)

class LegalContentFilter:
    """–ö–ª–∞—Å—Å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞."""
    
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ–∏–ª—å—Ç—Ä —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞."""
        self.legal_keywords = self._load_legal_keywords()
        self.legal_patterns = self._load_legal_patterns()
        self.non_legal_patterns = self._load_non_legal_patterns()
        self.min_legal_score = 0.20  # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä–æ–≥ –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (100% —Ç–æ—á–Ω–æ—Å—Ç—å)
        
    def _load_legal_keywords(self) -> Dict[str, List[str]]:
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞."""
        return {
            # –û—Å–Ω–æ–≤–Ω—ã–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã
            'core_legal': [
                '–∑–∞–∫–æ–Ω', '–∫–æ–¥–µ–∫—Å', '—Å—Ç–∞—Ç—å—è', '–ø—É–Ω–∫—Ç', '—á–∞—Å—Ç—å', '–≥–ª–∞–≤–∞', '—Ä–∞–∑–¥–µ–ª',
                '–ø–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ', '—É–∫–∞–∑', '–¥–µ–∫—Ä–µ—Ç', '—Ä–µ—à–µ–Ω–∏–µ', '–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ',
                '–ø—Ä–∞–≤–æ', '–æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç—å', '–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å', '–Ω–∞—Ä—É—à–µ–Ω–∏–µ', '—à—Ç—Ä–∞—Ñ',
                '—Å—É–¥', '—Å—É–¥–µ–±–Ω—ã–π', '–ø—Ä–∞–≤–æ—Å—É–¥–∏–µ', '–∏—Å–∫', '–∏—Å—Ç–µ—Ü', '–æ—Ç–≤–µ—Ç—á–∏–∫',
                '–¥–æ–≥–æ–≤–æ—Ä', '—Å–æ–≥–ª–∞—à–µ–Ω–∏–µ', '–∫–æ–Ω—Ç—Ä–∞–∫—Ç', '—Å–¥–µ–ª–∫–∞', '–æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ',
                '—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å', '–∏–º—É—â–µ—Å—Ç–≤–æ', '–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ', '–∑–∞–≤–µ—â–∞–Ω–∏–µ',
                '—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è', '–ª–∏—Ü–µ–Ω–∑–∏—è', '—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ', '—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ'
            ],
            
            # –ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã
            'belarus_legal': [
                '—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –±–µ–ª–∞—Ä—É—Å—å', '–±–µ–ª–∞—Ä—É—Å—å', '—Ä–±', '–±–µ–ª–æ—Ä—É—Å—Å–∫–∏–π',
                '—Å–æ–≤–µ—Ç –º–∏–Ω–∏—Å—Ç—Ä–æ–≤', '–ø—Ä–µ–∑–∏–¥–µ–Ω—Ç', '–ø–∞—Ä–ª–∞–º–µ–Ω—Ç', '–ø–∞–ª–∞—Ç–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π',
                '—Å–æ–≤–µ—Ç —Ä–µ—Å–ø—É–±–ª–∏–∫–∏', '–∫–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω–Ω—ã–π —Å—É–¥', '–≤–µ—Ä—Ö–æ–≤–Ω—ã–π —Å—É–¥',
                '–º–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ —é—Å—Ç–∏—Ü–∏–∏', '–≥–µ–Ω–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—É—Ä–∞—Ç—É—Ä–∞',
                '–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–∞–Ω–∫', '–∫–æ–º–∏—Ç–µ—Ç –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è'
            ],
            
            # –û—Ç—Ä–∞—Å–ª–∏ –ø—Ä–∞–≤–∞
            'law_branches': [
                '–≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–µ –ø—Ä–∞–≤–æ', '—Ç—Ä—É–¥–æ–≤–æ–µ –ø—Ä–∞–≤–æ', '—Å–µ–º–µ–π–Ω–æ–µ –ø—Ä–∞–≤–æ',
                '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–∞–≤–æ', '—É–≥–æ–ª–æ–≤–Ω–æ–µ –ø—Ä–∞–≤–æ', '–Ω–∞–ª–æ–≥–æ–≤–æ–µ –ø—Ä–∞–≤–æ',
                '—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–∞–≤–æ', '–∑–µ–º–µ–ª—å–Ω–æ–µ –ø—Ä–∞–≤–æ', '—ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ø—Ä–∞–≤–æ',
                '–∂–∏–ª–∏—â–Ω–æ–µ –ø—Ä–∞–≤–æ', '–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–∞–≤–æ', '–∞–≤—Ç–æ—Ä—Å–∫–æ–µ –ø—Ä–∞–≤–æ',
                '–ø–∞—Ç–µ–Ω—Ç–Ω–æ–µ –ø—Ä–∞–≤–æ', '–±–∞–Ω–∫–æ–≤—Å–∫–æ–µ –ø—Ä–∞–≤–æ', '—Å—Ç—Ä–∞—Ö–æ–≤–æ–µ –ø—Ä–∞–≤–æ'
            ],
            
            # –ü—Ä–∞–≤–æ–≤—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
            'legal_procedures': [
                '—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è', '–ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–∏–µ', '—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è', '–∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è',
                '—Å—É–¥–æ–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ', '–∞—Ä–±–∏—Ç—Ä–∞–∂', '–º–µ–¥–∏–∞—Ü–∏—è', '–Ω–æ—Ç–∞—Ä–∏–∞—Ç',
                '–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ', '–±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–æ', '–ª–∏–∫–≤–∏–¥–∞—Ü–∏—è',
                '—Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è', '—Å–ª–∏—è–Ω–∏–µ', '–ø–æ–≥–ª–æ—â–µ–Ω–∏–µ', '–∞—É–¥–∏—Ç'
            ],
            
            # –°—É–±—ä–µ–∫—Ç—ã –ø—Ä–∞–≤–∞
            'legal_entities': [
                '—Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ', '—é—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ', '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å',
                '–æ–±—â–µ—Å—Ç–≤–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é', '–∞–∫—Ü–∏–æ–Ω–µ—Ä–Ω–æ–µ –æ–±—â–µ—Å—Ç–≤–æ',
                '—É–Ω–∏—Ç–∞—Ä–Ω–æ–µ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ', '—É—á—Ä–µ–∂–¥–µ–Ω–∏–µ', '–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è',
                '–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –æ—Ä–≥–∞–Ω', '–º–µ—Å—Ç–Ω—ã–π –æ—Ä–≥–∞–Ω', '–¥–æ–ª–∂–Ω–æ—Å—Ç–Ω–æ–µ –ª–∏—Ü–æ'
            ],
            
            # –î–æ–∫—É–º–µ–Ω—Ç—ã
            'legal_documents': [
                '–ø–∞—Å–ø–æ—Ä—Ç', '—É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ', '—Å–ø—Ä–∞–≤–∫–∞', '–≤—ã–ø–∏—Å–∫–∞', '–∫–æ–ø–∏—è',
                '–∑–∞—è–≤–ª–µ–Ω–∏–µ', '–∂–∞–ª–æ–±–∞', '—Ö–æ–¥–∞—Ç–∞–π—Å—Ç–≤–æ', '–ø—Ä–æ—Ç–æ–∫–æ–ª', '–∞–∫—Ç',
                '–ø—Ä–∏–∫–∞–∑', '—Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ', '–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è', '–ø–æ–ª–æ–∂–µ–Ω–∏–µ', '—É—Å—Ç–∞–≤'
            ]
        }
    
    def _load_legal_patterns(self) -> List[str]:
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞."""
        return [
            r'—Å—Ç–∞—Ç—å[—è–∏]\s*\d+',  # —Å—Ç–∞—Ç—å—è 123
            r'–ø—É–Ω–∫—Ç\s*\d+',      # –ø—É–Ω–∫—Ç 5
            r'—á–∞—Å—Ç[—å–∏]\s*\d+',   # —á–∞—Å—Ç—å 2
            r'–≥–ª–∞–≤[–∞–µ]\s*\d+',   # –≥–ª–∞–≤–∞ 10
            r'—Ä–∞–∑–¥–µ–ª\s*\d+',     # —Ä–∞–∑–¥–µ–ª III
            r'–ø–æ–¥–ø—É–Ω–∫—Ç\s*\d+\.\d+',  # –ø–æ–¥–ø—É–Ω–∫—Ç 1.1
            r'–∞–±–∑–∞—Ü\s*\d+',      # –∞–±–∑–∞—Ü 3
            r'‚Ññ\s*\d+',          # ‚Ññ 123
            r'–æ—Ç\s*\d{1,2}\.\d{1,2}\.\d{4}',  # –æ—Ç 12.05.2023
            r'–≤ —Ä–µ–¥–∞–∫—Ü–∏–∏',       # –≤ —Ä–µ–¥–∞–∫—Ü–∏–∏
            r'—Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏',    # —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
            r'—É—Ç—Ä–∞—Ç–∏–ª —Å–∏–ª—É',     # —É—Ç—Ä–∞—Ç–∏–ª —Å–∏–ª—É
            r'–≤—Å—Ç—É–ø–∞–µ—Ç –≤ —Å–∏–ª—É',  # –≤—Å—Ç—É–ø–∞–µ—Ç –≤ —Å–∏–ª—É
            r'–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å', # –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å
            r'—Å–æ–≥–ª–∞—Å–Ω–æ',         # —Å–æ–≥–ª–∞—Å–Ω–æ
            r'–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏',     # –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏
            r'–≤ –ø–æ—Ä—è–¥–∫–µ',        # –≤ –ø–æ—Ä—è–¥–∫–µ
            r'–Ω–µ –ø–æ–∑–¥–Ω–µ–µ',       # –Ω–µ –ø–æ–∑–¥–Ω–µ–µ
            r'–≤ —Ç–µ—á–µ–Ω–∏–µ',        # –≤ —Ç–µ—á–µ–Ω–∏–µ
            r'–ø–æ–¥–ª–µ–∂–∏—Ç',         # –ø–æ–¥–ª–µ–∂–∏—Ç
            r'–æ–±—è–∑–∞–Ω',           # –æ–±—è–∑–∞–Ω
            r'–≤–ø—Ä–∞–≤–µ',           # –≤–ø—Ä–∞–≤–µ
            r'–∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ',      # –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ
            r'–Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å',  # –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
            r'—à—Ç—Ä–∞—Ñ\s*–≤ —Ä–∞–∑–º–µ—Ä–µ',      # —à—Ç—Ä–∞—Ñ –≤ —Ä–∞–∑–º–µ—Ä–µ
            r'–±–∞–∑–æ–≤—ã—Ö –≤–µ–ª–∏—á–∏–Ω',        # –±–∞–∑–æ–≤—ã—Ö –≤–µ–ª–∏—á–∏–Ω
            r'–±–µ–ª–æ—Ä—É—Å—Å–∫–∏—Ö —Ä—É–±–ª–µ–π',     # –±–µ–ª–æ—Ä—É—Å—Å–∫–∏—Ö —Ä—É–±–ª–µ–π
        ]
    
    def _load_non_legal_patterns(self) -> List[str]:
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞."""
        return [
            r'—Ä–µ—Ü–µ–ø—Ç',
            r'–∫—É–ª–∏–Ω–∞—Ä',
            r'–≥–æ—Ç–æ–≤–∏—Ç—å',
            r'–ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ',
            r'—Å–ø–æ—Ä—Ç',
            r'—Ñ—É—Ç–±–æ–ª',
            r'—Ö–æ–∫–∫–µ–π',
            r'–ø–æ–≥–æ–¥–∞',
            r'–≥–æ—Ä–æ—Å–∫–æ–ø',
            r'—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è',
            r'–∫–∏–Ω–æ',
            r'–º—É–∑—ã–∫–∞',
            r'–∏–≥—Ä—ã',
            r'–º–æ–¥–∞',
            r'–∫—Ä–∞—Å–æ—Ç–∞',
            r'–∑–¥–æ—Ä–æ–≤—å–µ',
            r'–º–µ–¥–∏—Ü–∏–Ω–∞',
            r'–ª–µ—á–µ–Ω–∏–µ',
            r'–±–æ–ª–µ–∑–Ω—å',
            r'—Ç—É—Ä–∏–∑–º',
            r'–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ',
            r'–æ—Ç–¥—ã—Ö',
            r'—Ä–µ–∫–ª–∞–º–∞',
            r'—Å–∫–∏–¥–∫–∞',
            r'—Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞',
            r'–∫—É–ø–∏—Ç—å',
            r'–ø—Ä–æ–¥–∞—Ç—å',
            r'—Ü–µ–Ω–∞',
            r'—Å—Ç–æ–∏–º–æ—Å—Ç—å',
            r'—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏',
            r'–∫–æ–º–ø—å—é—Ç–µ—Ä',
            r'–∏–Ω—Ç–µ—Ä–Ω–µ—Ç',
            r'—Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏'
        ]
    
    def is_legal_content(self, text: str, title: str = "", url: str = "") -> Tuple[bool, float, str]:
        """
        –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º.
        
        Args:
            text: –¢–µ–∫—Å—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            title: –ó–∞–≥–æ–ª–æ–≤–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            url: URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            
        Returns:
            Tuple[bool, float, str]: (—è–≤–ª—è–µ—Ç—Å—è_—é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º, –±–∞–ª–ª_—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏, –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ)
        """
        if not text or len(text.strip()) < 50:
            return False, 0.0, "–°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç"
        
        # –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        full_text = f"{title} {text}".lower()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –∏—Å–∫–ª—é—á–∞—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
        non_legal_score = self._calculate_non_legal_score(full_text)
        if non_legal_score > 0.5:
            return False, non_legal_score, "–°–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç"
        
        # –í—ã—á–∏—Å–ª—è–µ–º —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –±–∞–ª–ª
        legal_score = self._calculate_legal_score(full_text, url)
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
        structure_score = self._check_legal_structure(text)
        terminology_score = self._check_legal_terminology(full_text)
        
        # –ò—Ç–æ–≥–æ–≤—ã–π –±–∞–ª–ª —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ –≤–µ—Å–∞–º–∏
        total_score = (legal_score * 0.6 + structure_score * 0.25 + terminology_score * 0.15)
        
        # –ë–æ–Ω—É—Å –¥–ª—è –±–µ–ª–æ—Ä—É—Å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        if '–±–µ–ª–∞—Ä—É—Å—å' in full_text or '—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –±–µ–ª–∞—Ä—É—Å—å' in full_text or 'pravo.by' in url.lower():
            total_score += 0.1
        
        # –ë–æ–Ω—É—Å –¥–ª—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        if any(word in full_text for word in ['–ø–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ', '–¥–µ–∫—Ä–µ—Ç', '—É–∫–∞–∑', '–∑–∞–∫–æ–Ω', '–∫–æ–¥–µ–∫—Å']):
            total_score += 0.05
        
        is_legal = total_score >= self.min_legal_score
        
        explanation = self._generate_explanation(legal_score, structure_score, terminology_score, total_score)
        
        logger.info(f"–ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: –±–∞–ª–ª={total_score:.3f}, —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π={'–î–ê' if is_legal else '–ù–ï–¢'}")
        
        return is_legal, total_score, explanation
    
    def _calculate_legal_score(self, text: str, url: str = "") -> float:
        """–í—ã—á–∏—Å–ª—è–µ—Ç –±–∞–ª–ª —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏."""
        score = 0.0
        total_keywords = 0
        
        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
        for category, keywords in self.legal_keywords.items():
            category_score = 0
            for keyword in keywords:
                if keyword in text:
                    category_score += 1
                    total_keywords += 1
            
            # –í–µ—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            weights = {
                'core_legal': 0.3,
                'belarus_legal': 0.25,
                'law_branches': 0.2,
                'legal_procedures': 0.15,
                'legal_entities': 0.1,
                'legal_documents': 0.05
            }
            
            weight = weights.get(category, 0.1)
            score += (category_score / len(keywords)) * weight
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã
        pattern_score = 0
        for pattern in self.legal_patterns:
            matches = re.findall(pattern, text, re.IGNORECASE)
            if matches:
                pattern_score += len(matches) * 0.1
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –Ω–∞ —é—Ä–∏–¥–∏—á–µ—Å–∫—É—é —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å
        url_score = 0
        if url:
            legal_url_patterns = [
                'pravo.by', 'law', 'legal', '—é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π', '–ø—Ä–∞–≤–æ', '–∑–∞–∫–æ–Ω',
                'government', 'gov', '–º–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ', '–∫–æ–º–∏—Ç–µ—Ç', '—Å–æ–≤–µ—Ç'
            ]
            for pattern in legal_url_patterns:
                if pattern in url.lower():
                    url_score += 0.1
        
        total_score = min(score + pattern_score * 0.1 + url_score, 1.0)
        return total_score
    
    def _calculate_non_legal_score(self, text: str) -> float:
        """–í—ã—á–∏—Å–ª—è–µ—Ç –±–∞–ª–ª –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (—á–µ–º –≤—ã—à–µ, —Ç–µ–º –º–µ–Ω–µ–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π)."""
        score = 0.0
        
        for pattern in self.non_legal_patterns:
            matches = re.findall(pattern, text, re.IGNORECASE)
            if matches:
                score += len(matches) * 0.1
        
        return min(score, 1.0)
    
    def _check_legal_structure(self, text: str) -> float:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º."""
        score = 0.0
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤
        if re.search(r'\d+\.\s', text):
            score += 0.3
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å—Ç–∞—Ç—å–∏/–ø—É–Ω–∫—Ç—ã
        if re.search(r'(—Å—Ç–∞—Ç—å—è|–ø—É–Ω–∫—Ç|—á–∞—Å—Ç—å|–≥–ª–∞–≤–∞)\s*\d+', text, re.IGNORECASE):
            score += 0.4
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞—Ç –≤ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
        if re.search(r'\d{1,2}\.\d{1,2}\.\d{4}', text):
            score += 0.2
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω–æ–º–µ—Ä–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        if re.search(r'‚Ññ\s*\d+', text):
            score += 0.1
        
        return min(score, 1.0)
    
    def _check_legal_terminology(self, text: str) -> float:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏."""
        legal_terms = [
            '–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å', '—Å–æ–≥–ª–∞—Å–Ω–æ', '–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏', '–≤ –ø–æ—Ä—è–¥–∫–µ',
            '–Ω–µ –ø–æ–∑–¥–Ω–µ–µ', '–≤ —Ç–µ—á–µ–Ω–∏–µ', '–ø–æ–¥–ª–µ–∂–∏—Ç', '–æ–±—è–∑–∞–Ω', '–≤–ø—Ä–∞–≤–µ',
            '–∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ', '–Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å', '—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π',
            '–ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–π', '–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π', '—É–∫–∞–∑–∞–Ω–Ω—ã–π'
        ]
        
        found_terms = 0
        for term in legal_terms:
            if term in text:
                found_terms += 1
        
        return min(found_terms / len(legal_terms), 1.0)
    
    def _generate_explanation(self, legal_score: float, structure_score: float, 
                            terminology_score: float, total_score: float) -> str:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è."""
        parts = []
        
        if legal_score > 0.3:
            parts.append(f"—é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã ({legal_score:.2f})")
        
        if structure_score > 0.3:
            parts.append(f"—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ ({structure_score:.2f})")
        
        if terminology_score > 0.3:
            parts.append(f"–ø—Ä–∞–≤–æ–≤–∞—è —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è ({terminology_score:.2f})")
        
        if parts:
            return f"–ù–∞–π–¥–µ–Ω—ã: {', '.join(parts)}. –û–±—â–∏–π –±–∞–ª–ª: {total_score:.3f}"
        else:
            return f"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤. –ë–∞–ª–ª: {total_score:.3f}"
    
    def filter_scraped_content(self, scraped_data: List[Dict]) -> List[Dict]:
        """
        –§–∏–ª—å—Ç—Ä—É–µ—Ç —Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π.
        
        Args:
            scraped_data: –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
            
        Returns:
            –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–æ–ª—å–∫–æ —Å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
        """
        filtered_data = []
        total_pages = len(scraped_data)
        
        logger.info(f"üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞: –∞–Ω–∞–ª–∏–∑ {total_pages} —Å—Ç—Ä–∞–Ω–∏—Ü")
        
        for i, page_data in enumerate(scraped_data):
            url = page_data.get('url', '')
            title = page_data.get('title', '')
            content = page_data.get('content', '')
            
            if not content:
                logger.debug(f"–ü—Ä–æ–ø—É—Å–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã {i+1}: –ø—É—Å—Ç–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç")
                continue
            
            is_legal, score, explanation = self.is_legal_content(content, title, url)
            
            if is_legal:
                # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                page_data['legal_score'] = score
                page_data['legal_explanation'] = explanation
                page_data['filtered_at'] = datetime.now().isoformat()
                
                filtered_data.append(page_data)
                logger.info(f"‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ {i+1} –ø—Ä–æ—à–ª–∞ —Ñ–∏–ª—å—Ç—Ä: {title[:50]}... (–±–∞–ª–ª: {score:.3f})")
            else:
                logger.info(f"‚ùå –°—Ç—Ä–∞–Ω–∏—Ü–∞ {i+1} –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞: {title[:50]}... (–±–∞–ª–ª: {score:.3f}) - {explanation}")
        
        logger.info(f"üìä –†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: {len(filtered_data)}/{total_pages} —Å—Ç—Ä–∞–Ω–∏—Ü –ø—Ä–æ—à–ª–∏ —Ñ–∏–ª—å—Ç—Ä")
        
        return filtered_data
    
    def get_filter_statistics(self) -> Dict:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–∞–±–æ—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞."""
        return {
            'total_keywords': sum(len(keywords) for keywords in self.legal_keywords.values()),
            'legal_patterns': len(self.legal_patterns),
            'non_legal_patterns': len(self.non_legal_patterns),
            'min_legal_score': self.min_legal_score,
            'categories': list(self.legal_keywords.keys())
        }

def create_legal_content_filter() -> LegalContentFilter:
    """–°–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä —Ñ–∏–ª—å—Ç—Ä–∞ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞."""
    return LegalContentFilter() 